clear 
clc

rng(1,'twister');

addpath ~/Desktop/Courses/TNU/Project/spm12
addpath ~/Desktop/Courses/TNU/Project/spm12/toolbox/DEM

num_trials = 10;
num_episodes = 50;
z  = randsample(num_episodes, 8); % change context for some episodes
pLoc = randi([1 5], 1);
vLoc = randi([1 5], 1);

% With preferences:
trwp = zeros(num_episodes, num_trials);
 for j = 1:num_trials
      mdp = {};
      
      for i = 1:num_episodes
             MDP = dyshomeostasisModel();   
            
             if i > 1
                % using the posterior from previous trial as the 
                % prior for this trial
                MDP.D{2} = X; 
             end
             
             if sum(z==i) == 1
                 pLoc = randi([1 5], 1);
                 vLoc = randi([1 5], 1);
                 [MDP.s]     = [3 pLoc]';
             else
                 [MDP.s]     = [3 vLoc]';
             end

             MDP  = spm_MDP_VB_X(MDP);     
             mdp{i} = MDP;
             trwp(i,j) = MDP.o(MDP.T);        
             
             % keeping the posterior
             X = MDP.X{2}(:,end);
            
     end    
 end
 